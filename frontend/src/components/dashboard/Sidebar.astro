---
import { Image } from "astro:assets";
import logo from "@assets/Logo_RDL.png";
import { allNavItems } from "@lib/utils/allNavItems";

const { user } = Astro.locals;
const currentPath = Astro.url.pathname;

const navItems = allNavItems.filter((item) => {
  if (!item.roles) return true;
  const userRole = (user?.role?.name || "").toLowerCase();
  return item.roles.some((role) => role.toLowerCase() === userRole);
});
---

<aside
  class="z-10 hidden w-64 flex-col border-r border-gray-200 bg-white/80 shadow-xl backdrop-blur-md md:flex"
>
  <div class="flex justify-center p-6">
    <Image src={logo} alt="Rayito de Luz" class="h-auto w-32" />
  </div>

  <nav class="flex-1 space-y-1 px-4 py-4">
    {
      navItems.map((item) => {
        const isActive =
          item.href === "/dashboard" || item.href === "/dashboard/tutor"
            ? currentPath === item.href
            : currentPath.startsWith(item.href);

        return (
          <a
            href={item.href}
            class={`group flex items-center rounded-xl px-4 py-3 transition-all duration-200 ${
              isActive
                ? "bg-rayito-blue shadow-rayito-blue/30 text-white shadow-lg"
                : "hover:bg-rayito-blue/5 hover:text-rayito-blue text-gray-600"
            }`}
          >
            <span class="mr-3 text-xl">{item.icon}</span>
            <span class="font-medium">{item.label}</span>
          </a>
        );
      })
    }
  </nav>

  <div class="border-t border-gray-100 p-4">
    <div class="flex items-center rounded-xl bg-gray-50 p-3">
      <div
        class="bg-rayito-yellow flex h-10 w-10 items-center justify-center rounded-full font-bold text-white shadow-sm"
      >
        {user?.username?.charAt(0).toUpperCase() || "U"}
      </div>
      <div class="ml-3 overflow-hidden">
        <p class="truncate text-sm font-semibold text-gray-900">
          {user?.profile?.names || "Nombre"}
          {user?.profile?.surnames || "Apellido"}
        </p>
        <p class="truncate text-xs text-gray-500">
          {user?.role?.name || ""}
        </p>
      </div>
    </div>

    <form action="/api/v1/auth/logout" method="POST" class="mt-2">
      <button
        type="submit"
        class="flex w-full items-center rounded-lg px-4 py-2 text-left text-sm font-medium text-red-600 transition-colors hover:bg-red-50"
      >
        <span class="mr-2">ðŸšª</span> Cerrar SesiÃ³n
      </button>
    </form>
  </div>
</aside>
